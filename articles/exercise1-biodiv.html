<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="srcquantcourse">
<title>Exercise 1: Topic modeling biodiversity preprints • srcquantcourse</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Exercise 1: Topic modeling biodiversity preprints">
<meta property="og:description" content="srcquantcourse">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">srcquantcourse</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/covid-preprint-topics.html">Example: Topic modelling Covid preprints</a>
    <a class="dropdown-item" href="../articles/evaluate-k.html">Choosing the number of topics (K)</a>
    <a class="dropdown-item" href="../articles/exercise1-biodiv.html">Exercise 1: Topic modeling biodiversity preprints</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sdaume/srcquantcourse/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Exercise 1: Topic modeling biodiversity preprints</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sdaume/srcquantcourse/blob/HEAD/vignettes/exercise1-biodiv.Rmd" class="external-link"><code>vignettes/exercise1-biodiv.Rmd</code></a></small>
      <div class="d-none name"><code>exercise1-biodiv.Rmd</code></div>
    </div>

    
    
<p>This exercise follows the structure of the
<code><a href="../articles/covid-preprint-topics.html">vignette("covid-preprint-topics")</a></code> and adapts it to create a
topic model for preprints referencing the term <em>‘biodiversity’</em>
in either the preprint title or abstract. Refer back to the
<code><a href="../articles/covid-preprint-topics.html">vignette("covid-preprint-topics")</a></code> for more information
about the individual steps.</p>
<p>Either try the steps yourself with the help of the example in the
<code><a href="../articles/covid-preprint-topics.html">vignette("covid-preprint-topics")</a></code> or jump ahead to the
<strong><a href="#solution">Solution</a></strong> section.</p>
<div class="section level2">
<h2 id="exercise-tasks">Exercise tasks<a class="anchor" aria-label="anchor" href="#exercise-tasks"></a>
</h2>
<div class="section level3">
<h3 id="getting-the-document-data">Getting the document data<a class="anchor" aria-label="anchor" href="#getting-the-document-data"></a>
</h3>
<p>We assume that you have created a local copy of the preprint data to
run this analysis (see information and code samples for <em>“Getting the
document data”</em> in
<code><a href="../articles/covid-preprint-topics.html">vignette("covid-preprint-topics")</a></code>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"PREPRINT_RDATA_LOCATION_HERE"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cleaning-filtering-and-annotating-the-data">Cleaning, filtering and annotating the data<a class="anchor" aria-label="anchor" href="#cleaning-filtering-and-annotating-the-data"></a>
</h3>
<p>For this example we are planning to explore whether the publication
status influences the topic prevalence. We therefore adapt the time
range and consider preprints added from 2017 to 2021. We then reduce
this to a subset of preprints that reference the term
<em>‘biodiversity’</em> in either the preprint title or abstract.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># adapt based on the covid preprints example</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="preparing-and-preprocessing-the-documents-for-text-analysis">Preparing and preprocessing the documents for text analysis<a class="anchor" aria-label="anchor" href="#preparing-and-preprocessing-the-documents-for-text-analysis"></a>
</h3>
<div class="section level4">
<h4 id="create-a-corpus">Create a corpus<a class="anchor" aria-label="anchor" href="#create-a-corpus"></a>
</h4>
<p>Create a <strong>corpus</strong> and explore its properties.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># quanteda is used for corpus creation</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="tokenize-and-preprocess">Tokenize and preprocess<a class="anchor" aria-label="anchor" href="#tokenize-and-preprocess"></a>
</h4>
<p>Tokenize by applying the same steps as in the Covid preprint
example.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># quanteda is used for tokenization</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-a-document-feature-matrix">Create a Document-feature matrix<a class="anchor" aria-label="anchor" href="#create-a-document-feature-matrix"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># quanteda is used for creation of a DFM </span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filter-terms-and-documents">Filter terms and documents<a class="anchor" aria-label="anchor" href="#filter-terms-and-documents"></a>
</h4>
<p>Remove stopwords from the document-feature-matrix. Explore its
properties.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># quanteda is used for stopword removal </span></span></code></pre></div>
<p>Filter tokens and documents by applying the same approach as in the
Covid preprint example.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># quanteda is used for filtering</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="topic-modeling">Topic modeling<a class="anchor" aria-label="anchor" href="#topic-modeling"></a>
</h3>
<div class="section level4">
<h4 id="fitting-the-stm-topic-model">Fitting the STM topic model<a class="anchor" aria-label="anchor" href="#fitting-the-stm-topic-model"></a>
</h4>
<p>Fit an <code>stm</code> topic model with 10 topics to the prepared
data. The model should consider an interacting effect between the
covariates <code>is_published</code> and publication <code>year</code>
on topical prevalence. Apply a <code>seed</code> argument with the value
<em>9868467</em>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># convert the DFM into stm format and run the stm() function</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="estimating-the-effect-of-document-covariates">Estimating the effect of document covariates<a class="anchor" aria-label="anchor" href="#estimating-the-effect-of-document-covariates"></a>
</h4>
<p>Evaluate the effect of the previously chosen topic prevalence
covariates on all topics.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimateEffect() on the topic model</span></span></code></pre></div>
<p>This concludes fitting the model. The following sections step through
a sample exploration of this topic model.</p>
</div>
</div>
<div class="section level3">
<h3 id="analysing-and-interpreting-the-topic-model">Analysing and interpreting the topic model<a class="anchor" aria-label="anchor" href="#analysing-and-interpreting-the-topic-model"></a>
</h3>
<div class="section level4">
<h4 id="basic-topic-model-information">Basic topic model information<a class="anchor" aria-label="anchor" href="#basic-topic-model-information"></a>
</h4>
<p>Plot a model summary with the 7 most frequent words per topic.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stm plot() teh topic model provides a summary of topic proportions</span></span></code></pre></div>
<p>Print a <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> of the topic model and explore the
sets of words that characterize the 10 topics.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print a summary() of the topic model</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="understanding-and-labeling-topics">Understanding and labeling topics<a class="anchor" aria-label="anchor" href="#understanding-and-labeling-topics"></a>
</h3>
<p>Create word clouds for all 10 topics using the 30 words with the
highest probability per topic. Remove the term “biodiversity” from this
display.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># word clouds are a useful first step to arrive at summary labels for topics</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="covariate-effects">Covariate effects<a class="anchor" aria-label="anchor" href="#covariate-effects"></a>
</h3>
<p>Print the regression tables for all or selected topics.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print a summary() of effects</span></span></code></pre></div>
<div class="section level4">
<h4 id="publication-year">Publication year<a class="anchor" aria-label="anchor" href="#publication-year"></a>
</h4>
<p>Use the <code>stm</code> plot method to create a plot that shows the
effect of publication <code>year</code> on topical prevalence for Topic
4 and Topic 8. Annotate with the most probable terms.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stm plot offers various different plot options for covariate effects</span></span></code></pre></div>
<p>Alternatively, the <code>stminsights</code> package could be used to
extract the same regression information from the <code>stm</code>
effects object and create customized charts.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stminsights allows to get effects in a format suitable for ggplot2</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="publication-status-effect">Publication status effect<a class="anchor" aria-label="anchor" href="#publication-status-effect"></a>
</h4>
<p>We also incoporated the publication status into the model (covariate
<code>is_published</code>). Using the <code>stm</code> plot method
explore the effect of the treatment “published” on topical
prevalence.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stm plot offers various different plotoptions for covariate effects</span></span></code></pre></div>
<p>Compare the topical prevalence effect of covariate
<code>is_published</code> for Topic 4.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stm plot offers various different plotoptions for covariate effects</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="combination-of-publication-status-and-publication-year">Combination of publication status and publication year<a class="anchor" aria-label="anchor" href="#combination-of-publication-status-and-publication-year"></a>
</h4>
<p>Finally, we can also explore the combined effect of covariates; we
assumed an interacting effect of the two covariates
<code>is_published</code> and <code>year</code>. Using the
<code>stm</code> plot function explore the combined interacting
covariate effect for Topic 4.</p>
<p>Again, <code>stminsights</code> can be used to retrieve this
information and create customized visualizations for the combined
covariate effect.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stminsights allows to get effects in a format suitable for ggplot2</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="exploring-the-topic-structure">Exploring the topic structure<a class="anchor" aria-label="anchor" href="#exploring-the-topic-structure"></a>
</h3>
<div class="section level4">
<h4 id="topic-correlations">Topic correlations<a class="anchor" aria-label="anchor" href="#topic-correlations"></a>
</h4>
<p>Finally, retrieve the topic correlations matrix and plot a
cooccurrence network.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># topic correlations retrieved with stm</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="solution">Solution<a class="anchor" aria-label="anchor" href="#solution"></a>
</h2>
<div class="section level3">
<h3 id="getting-the-document-data-1">Getting the document data<a class="anchor" aria-label="anchor" href="#getting-the-document-data-1"></a>
</h3>
<p>We assume that you have created a local copy of the preprint data to
run this analysis (see information and code samples for <em>“Getting the
document data”</em> in
<code><a href="../articles/covid-preprint-topics.html">vignette("covid-preprint-topics")</a></code>).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"PREPRINT_RDATA_LOCATION_HERE"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cleaning-filtering-and-annotating-the-data-1">Cleaning, filtering and annotating the data<a class="anchor" aria-label="anchor" href="#cleaning-filtering-and-annotating-the-data-1"></a>
</h3>
<p>For this example we are planning to explore whether the publication
status influences the topic prevalence. We therefore adapt the time
range and consider preprints added from 2017 to 2021. We then reduce
this to a subset of preprints that reference the term
<em>‘biodiversity’</em> in either the preprint title or abstract.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">preprints_cleaned</span> <span class="op">&lt;-</span> <span class="va">preprints_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">doi</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">version</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">version</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">doi</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preprints</span> <span class="op">&lt;-</span> <span class="va">preprints_cleaned</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>published <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span><span class="va">published</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>published <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/na_if.html" class="external-link">na_if</a></span><span class="op">(</span><span class="va">published</span>, <span class="st">"NA"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_published <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">published</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_published <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">is_published</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"published"</span>,</span>
<span>                                  <span class="va">is_published</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"not published"</span>,</span>
<span>                                  <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"undefined"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2017</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2021</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">doi</span>, <span class="va">server</span>, <span class="va">title</span>, <span class="va">abstract</span>, <span class="va">date</span>, <span class="va">year</span>, <span class="va">version</span>, <span class="va">is_published</span><span class="op">)</span></span>
<span></span>
<span><span class="va">keywords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"biodiversity"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">search_pattern</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html" class="external-link">regex</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">keywords</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span>, </span>
<span>                                 ignore_case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">biodiv_preprints</span> <span class="op">&lt;-</span> <span class="va">preprints</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">title</span>, pattern <span class="op">=</span> <span class="va">search_pattern</span><span class="op">)</span> <span class="op">|</span></span>
<span>           <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">abstract</span>, pattern <span class="op">=</span> <span class="va">search_pattern</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="preparing-and-preprocessing-the-documents-for-text-analysis-1">Preparing and preprocessing the documents for text analysis<a class="anchor" aria-label="anchor" href="#preparing-and-preprocessing-the-documents-for-text-analysis-1"></a>
</h3>
<div class="section level4">
<h4 id="create-a-corpus-1">Create a corpus<a class="anchor" aria-label="anchor" href="#create-a-corpus-1"></a>
</h4>
<p>Create a <strong>corpus</strong> and explore its properties.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://quanteda.io" class="external-link">quanteda</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">pubs_corpus</span> <span class="op">&lt;-</span> <span class="va">biodiv_preprints</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">quanteda</span><span class="fu">::</span><span class="fu"><a href="https://quanteda.io/reference/corpus.html" class="external-link">corpus</a></span><span class="op">(</span>docid_field <span class="op">=</span> <span class="st">"doi"</span>, text_field <span class="op">=</span> <span class="st">"abstract"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># pubs_corpus</span></span>
<span><span class="co"># Corpus consisting of 29,692 documents and 6 docvars.</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="tokenize-and-preprocess-1">Tokenize and preprocess<a class="anchor" aria-label="anchor" href="#tokenize-and-preprocess-1"></a>
</h4>
<p>Tokenize by applying the same steps as in the Covid preprint
example.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pubs_tokens</span> <span class="op">&lt;-</span> <span class="va">pubs_corpus</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">quanteda</span><span class="fu">::</span><span class="fu"><a href="https://quanteda.io/reference/tokens.html" class="external-link">tokens</a></span><span class="op">(</span>remove_punct <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   remove_symbols <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   remove_numbers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   remove_url <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   remove_separators <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   split_hyphens <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-a-document-feature-matrix-1">Create a Document-feature matrix<a class="anchor" aria-label="anchor" href="#create-a-document-feature-matrix-1"></a>
</h4>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pubs_dfm</span> <span class="op">&lt;-</span> <span class="va">pubs_tokens</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">quanteda</span><span class="fu">::</span><span class="fu"><a href="https://quanteda.io/reference/dfm.html" class="external-link">dfm</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filter-terms-and-documents-1">Filter terms and documents<a class="anchor" aria-label="anchor" href="#filter-terms-and-documents-1"></a>
</h4>
<p>Remove stopwords from the document-feature-matrix. Explore its
properties.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pubs_dfm</span> <span class="op">&lt;-</span> <span class="va">pubs_dfm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">quanteda</span><span class="fu">::</span><span class="fu"><a href="https://quanteda.io/reference/dfm_select.html" class="external-link">dfm_remove</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="fu">quanteda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stopwords/man/stopwords.html" class="external-link">stopwords</a></span><span class="op">(</span><span class="st">"english"</span><span class="op">)</span><span class="op">)</span> <span class="co">#%&gt;%</span></span>
<span>  <span class="co">#quanteda::dfm_wordstem()</span></span></code></pre></div>
<p>Filter tokens and documents by applying the same approach as in the
Covid preprint example.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pubs_dfm</span> <span class="op">&lt;-</span> <span class="va">pubs_dfm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">quanteda</span><span class="fu">::</span><span class="fu"><a href="https://quanteda.io/reference/dfm_select.html" class="external-link">dfm_remove</a></span><span class="op">(</span>min_nchar <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">quanteda</span><span class="fu">::</span><span class="fu"><a href="https://quanteda.io/reference/dfm_trim.html" class="external-link">dfm_trim</a></span><span class="op">(</span>min_docfreq <span class="op">=</span> <span class="fl">2</span>, docfreq_type <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">quanteda</span><span class="fu">::</span><span class="fu"><a href="https://quanteda.io/reference/dfm_subset.html" class="external-link">dfm_subset</a></span><span class="op">(</span><span class="fu">quanteda</span><span class="fu">::</span><span class="fu"><a href="https://quanteda.io/reference/ntoken.html" class="external-link">ntoken</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="topic-modeling-1">Topic modeling<a class="anchor" aria-label="anchor" href="#topic-modeling-1"></a>
</h3>
<div class="section level4">
<h4 id="fitting-the-stm-topic-model-1">Fitting the STM topic model<a class="anchor" aria-label="anchor" href="#fitting-the-stm-topic-model-1"></a>
</h4>
<p>Fit an <code>stm</code> topic model with 10 topics to the prepared
data. The model should consider an interacting effect between the
covariates <code>is_published</code> and publication <code>year</code>
on topical prevalence. Apply a <code>seed</code> argument with the value
<em>9868467</em>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.structuraltopicmodel.com/" class="external-link">stm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">biodiv_stm_docs</span> <span class="op">&lt;-</span> <span class="fu">quanteda</span><span class="fu">::</span><span class="fu"><a href="https://quanteda.io/reference/convert.html" class="external-link">convert</a></span><span class="op">(</span><span class="va">pubs_dfm</span>, to <span class="op">=</span> <span class="st">"stm"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">biodiv_model_K10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/stm/man/stm.html" class="external-link">stm</a></span><span class="op">(</span>documents <span class="op">=</span> <span class="va">biodiv_stm_docs</span><span class="op">$</span><span class="va">documents</span>,</span>
<span>                    vocab <span class="op">=</span> <span class="va">biodiv_stm_docs</span><span class="op">$</span><span class="va">vocab</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">biodiv_stm_docs</span><span class="op">$</span><span class="va">meta</span>,</span>
<span>                    prevalence <span class="op">=</span> <span class="op">~</span> <span class="va">is_published</span> <span class="op">*</span> <span class="va">year</span>,</span>
<span>                    K <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                    verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    seed <span class="op">=</span> <span class="va">seed_stm</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="estimating-the-effect-of-document-covariates-1">Estimating the effect of document covariates<a class="anchor" aria-label="anchor" href="#estimating-the-effect-of-document-covariates-1"></a>
</h4>
<p>Evaluate the effect of the previously chosen topic prevalence
covariates on all topics.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biodiv_effect_K10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/stm/man/estimateEffect.html" class="external-link">estimateEffect</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span> <span class="op">~</span> <span class="va">is_published</span> <span class="op">*</span> <span class="va">year</span>,</span>
<span>                                   stmobj <span class="op">=</span> <span class="va">biodiv_model_K10</span>,</span>
<span>                                   metadata <span class="op">=</span> <span class="va">biodiv_stm_docs</span><span class="op">$</span><span class="va">meta</span><span class="op">)</span></span></code></pre></div>
<p>This concludes fitting the model. The following sections step through
a sample exploration of this topic model.</p>
</div>
</div>
<div class="section level3">
<h3 id="analysing-and-interpreting-the-topic-model-1">Analysing and interpreting the topic model<a class="anchor" aria-label="anchor" href="#analysing-and-interpreting-the-topic-model-1"></a>
</h3>
<div class="section level4">
<h4 id="basic-topic-model-information-1">Basic topic model information<a class="anchor" aria-label="anchor" href="#basic-topic-model-information-1"></a>
</h4>
<p>Plot a model summary with the 7 most frequent words per topic.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">biodiv_model_K10</span>, n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercise1-biodiv_files/figure-html/unnamed-chunk-31-1.png" width="2000"></p>
<p>Print a <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> of the topic model and explore the
sets of words that characterize the 10 topics.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="fu">summary</span>(biodiv_model_K10)</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="sc">&gt;</span><span class="co"># A topic model with 10 topics, 1495 documents and a 8838 word dictionary.</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 1 Top Words:</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Highest Prob: species, fish, marine, invasive, biodiversity, native, river </span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       FREX: coral, reefs, lakes, fisheries, reef, fishing, ocean </span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Lift: advection, afdw, aggregations, aleutian, ampat, amphipods, andaman </span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Score: fish, reef, islands, coral, fisheries, fishing, sea </span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 2 Top Words:</span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Highest Prob: data, species, biodiversity, can, information, using, research </span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       FREX: user, users, automated, learning, databases, images, algorithms </span></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Lift: cheilostome, cnns, crux, digitized, disparities, dnn, echolocating </span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Score: images, users, user, algorithms, pipeline, learning, students </span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 3 Top Words:</span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Highest Prob: host, disease, biodiversity, populations, microbiota, human, infection </span></span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       FREX: infection, pathogen, virus, viruses, viral, diseases, infections </span></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Lift: antimicrobial, antimicrobials, attack, auxiliary, baits, brain, brood </span></span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Score: infection, disease, host, pathogen, gut, microbiota, virus </span></span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 4 Top Words:</span></span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Highest Prob: genetic, species, genome, populations, gene, population, genes </span></span>
<span id="cb30-21"><a href="#cb30-21" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       FREX: snp, alleles, introgression, genome, genomic, genetic, genomes </span></span>
<span id="cb30-22"><a href="#cb30-22" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Lift: 3a, admixed, angustifolia, antibacterial, aureus, beak, beast </span></span>
<span id="cb30-23"><a href="#cb30-23" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Score: genome, genetic, genes, genomes, genomic, gene, speciation </span></span>
<span id="cb30-24"><a href="#cb30-24" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 5 Top Words:</span></span>
<span id="cb30-25"><a href="#cb30-25" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Highest Prob: species, model, biodiversity, can, ecological, models, dynamics </span></span>
<span id="cb30-26"><a href="#cb30-26" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       FREX: coexistence, competitive, theory, simulations, competition, stability, empirical </span></span>
<span id="cb30-27"><a href="#cb30-27" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Lift: abandon, absences, accumulates, aggressively, anchovy, archosaurs, assumes </span></span>
<span id="cb30-28"><a href="#cb30-28" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Score: competitive, theory, coexistence, competition, stability, simulations, preemption </span></span>
<span id="cb30-29"><a href="#cb30-29" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 6 Top Words:</span></span>
<span id="cb30-30"><a href="#cb30-30" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Highest Prob: species, diversity, biodiversity, change, richness, climate, across </span></span>
<span id="cb30-31"><a href="#cb30-31" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       FREX: climatic, gradients, biotic, turnover, climate, scales, richness </span></span>
<span id="cb30-32"><a href="#cb30-32" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Lift: arabia, bioregions, bryophyte, constantly, divide, endotherms, equivalence </span></span>
<span id="cb30-33"><a href="#cb30-33" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Score: richness, climate, elevational, phylogenetic, zeta, ldg, gradients </span></span>
<span id="cb30-34"><a href="#cb30-34" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 7 Top Words:</span></span>
<span id="cb30-35"><a href="#cb30-35" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Highest Prob: plant, soil, diversity, communities, microbial, community, species </span></span>
<span id="cb30-36"><a href="#cb30-36" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       FREX: mixtures, fire, soil, aboveground, amf, nitrogen, plant </span></span>
<span id="cb30-37"><a href="#cb30-37" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Lift: biodiv, conditioned, decomposer, exudate, fertilisation, microclimate, microsite </span></span>
<span id="cb30-38"><a href="#cb30-38" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Score: soil, microbial, grazing, bacterial, amf, mixtures, crop </span></span>
<span id="cb30-39"><a href="#cb30-39" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 8 Top Words:</span></span>
<span id="cb30-40"><a href="#cb30-40" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Highest Prob: forest, forests, species, tree, cover, de, biodiversity </span></span>
<span id="cb30-41"><a href="#cb30-41" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       FREX: forest, forests, en, de, plantations, la, es </span></span>
<span id="cb30-42"><a href="#cb30-42" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Lift: como, diversidad, landcover, que, una, vegetable, acacia </span></span>
<span id="cb30-43"><a href="#cb30-43" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Score: forest, forests, la, que, de, las, plantations </span></span>
<span id="cb30-44"><a href="#cb30-44" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 9 Top Words:</span></span>
<span id="cb30-45"><a href="#cb30-45" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Highest Prob: conservation, species, biodiversity, areas, land, use, management </span></span>
<span id="cb30-46"><a href="#cb30-46" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       FREX: iucn, socio, protected, lands, pas, conservation, nations </span></span>
<span id="cb30-47"><a href="#cb30-47" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Lift: eu, herpetofauna, pas, 30x30, abroad, accessing, achievements </span></span>
<span id="cb30-48"><a href="#cb30-48" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Score: protected, land, pas, iucn, lands, natura, conservation </span></span>
<span id="cb30-49"><a href="#cb30-49" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 10 Top Words:</span></span>
<span id="cb30-50"><a href="#cb30-50" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Highest Prob: dna, edna, samples, species, metabarcoding, biodiversity, diversity </span></span>
<span id="cb30-51"><a href="#cb30-51" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       FREX: edna, metabarcoding, samples, dna, primer, coi, biomonitoring </span></span>
<span id="cb30-52"><a href="#cb30-52" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Lift: 1the, acuta, asv, battery, benthos, bony, bruv </span></span>
<span id="cb30-53"><a href="#cb30-53" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#       Score: edna, metabarcoding, dna, samples, primer, coi, cristatus</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="understanding-and-labeling-topics-1">Understanding and labeling topics<a class="anchor" aria-label="anchor" href="#understanding-and-labeling-topics-1"></a>
</h3>
<p>Create word clouds for all 10 topics using the 30 words with the
highest probability per topic. Remove the term “biodiversity” from this
display.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get the top FREX words</span></span>
<span><span class="va">frex_top20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/stm/man/labelTopics.html" class="external-link">labelTopics</a></span><span class="op">(</span><span class="va">biodiv_model_K10</span>, n <span class="op">=</span> <span class="fl">25</span><span class="op">)</span><span class="op">$</span><span class="va">frex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"topic"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"V"</span><span class="op">)</span>, values_to <span class="op">=</span> <span class="st">"term"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_frex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">topic_words</span> <span class="op">&lt;-</span> <span class="fu">tidytext</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">biodiv_model_K10</span>, matrix <span class="op">=</span> <span class="st">"beta"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">#filter(!(term %in% c("sars", "cov", "covid"))) %&gt;% </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">topic</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">topic</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>beta_norm <span class="op">=</span> <span class="op">(</span><span class="va">beta</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">frex_top20</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"topic"</span>, <span class="st">"term"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is_frex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">is_frex</span><span class="op">)</span>, <span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">term</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"biodiversity"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Topic"</span>, <span class="va">topic</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">topic_words</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">term</span>, size <span class="op">=</span> <span class="va">beta_norm</span>, color <span class="op">=</span> <span class="va">is_frex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggwordcloud</span><span class="fu">::</span><span class="fu"><a href="https://lepennec.github.io/ggwordcloud/reference/geom_text_wordcloud.html" class="external-link">geom_text_wordcloud_area</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="st">"square"</span>,</span>
<span>                                        family <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>                                        rm_outside <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_radius</span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"1"</span> <span class="op">=</span> <span class="st">"#D55E00"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">topic</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="exercise1-biodiv_files/figure-html/unnamed-chunk-33-1.png" alt="**Word clouds showing the 30 most probable terms per topic.**" width="768"><p class="caption">
<strong>Word clouds showing the 30 most probable terms per
topic.</strong>
</p>
</div>
</div>
<div class="section level3">
<h3 id="covariate-effects-1">Covariate effects<a class="anchor" aria-label="anchor" href="#covariate-effects-1"></a>
</h3>
<p>Print the regression tables for all or selected topics.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="fu">summary</span>(biodiv_effect_K10)</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="sc">&gt;</span><span class="co"># </span></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Call:</span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># estimateEffect(formula = 1:10 ~ is_published * year, stmobj = biodiv_model_K10, </span></span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#     metadata = biodiv_stm_docs$meta)</span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 1:</span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Coefficients:</span></span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#                              Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># (Intercept)                -1.6741491 15.1093766  -0.111    0.912</span></span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished      -7.0738432 19.4059974  -0.365    0.716</span></span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># year                        0.0008706  0.0074813   0.116    0.907</span></span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished:year  0.0034983  0.0096085   0.364    0.716</span></span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-18"><a href="#cb32-18" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-19"><a href="#cb32-19" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 2:</span></span>
<span id="cb32-20"><a href="#cb32-20" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-21"><a href="#cb32-21" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Coefficients:</span></span>
<span id="cb32-22"><a href="#cb32-22" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#                             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb32-23"><a href="#cb32-23" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># (Intercept)                -5.804916  17.529779  -0.331    0.741</span></span>
<span id="cb32-24"><a href="#cb32-24" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished       4.614834  23.154506   0.199    0.842</span></span>
<span id="cb32-25"><a href="#cb32-25" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># year                        0.002927   0.008679   0.337    0.736</span></span>
<span id="cb32-26"><a href="#cb32-26" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished:year -0.002290   0.011464  -0.200    0.842</span></span>
<span id="cb32-27"><a href="#cb32-27" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-28"><a href="#cb32-28" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-29"><a href="#cb32-29" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 3:</span></span>
<span id="cb32-30"><a href="#cb32-30" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-31"><a href="#cb32-31" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Coefficients:</span></span>
<span id="cb32-32"><a href="#cb32-32" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#                              Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb32-33"><a href="#cb32-33" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># (Intercept)                -1.8870266 18.0104321  -0.105    0.917</span></span>
<span id="cb32-34"><a href="#cb32-34" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished      -2.2533465 22.7403975  -0.099    0.921</span></span>
<span id="cb32-35"><a href="#cb32-35" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># year                        0.0009683  0.0089173   0.109    0.914</span></span>
<span id="cb32-36"><a href="#cb32-36" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished:year  0.0011224  0.0112595   0.100    0.921</span></span>
<span id="cb32-37"><a href="#cb32-37" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-38"><a href="#cb32-38" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-39"><a href="#cb32-39" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 4:</span></span>
<span id="cb32-40"><a href="#cb32-40" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-41"><a href="#cb32-41" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Coefficients:</span></span>
<span id="cb32-42"><a href="#cb32-42" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#                             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb32-43"><a href="#cb32-43" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># (Intercept)                10.185198  19.263883   0.529    0.597</span></span>
<span id="cb32-44"><a href="#cb32-44" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished      11.985349  23.718983   0.505    0.613</span></span>
<span id="cb32-45"><a href="#cb32-45" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># year                       -0.005000   0.009538  -0.524    0.600</span></span>
<span id="cb32-46"><a href="#cb32-46" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished:year -0.005918   0.011744  -0.504    0.614</span></span>
<span id="cb32-47"><a href="#cb32-47" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-48"><a href="#cb32-48" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-49"><a href="#cb32-49" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 5:</span></span>
<span id="cb32-50"><a href="#cb32-50" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-51"><a href="#cb32-51" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Coefficients:</span></span>
<span id="cb32-52"><a href="#cb32-52" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#                              Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb32-53"><a href="#cb32-53" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># (Intercept)                 24.321375  18.642413   1.305    0.192</span></span>
<span id="cb32-54"><a href="#cb32-54" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished      -10.432309  23.638078  -0.441    0.659</span></span>
<span id="cb32-55"><a href="#cb32-55" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># year                        -0.011983   0.009230  -1.298    0.194</span></span>
<span id="cb32-56"><a href="#cb32-56" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished:year   0.005159   0.011704   0.441    0.659</span></span>
<span id="cb32-57"><a href="#cb32-57" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-58"><a href="#cb32-58" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-59"><a href="#cb32-59" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 6:</span></span>
<span id="cb32-60"><a href="#cb32-60" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-61"><a href="#cb32-61" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Coefficients:</span></span>
<span id="cb32-62"><a href="#cb32-62" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#                              Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb32-63"><a href="#cb32-63" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># (Intercept)                14.3230768 17.3420440   0.826    0.409</span></span>
<span id="cb32-64"><a href="#cb32-64" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished       0.3822469 22.2861426   0.017    0.986</span></span>
<span id="cb32-65"><a href="#cb32-65" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># year                       -0.0070247  0.0085865  -0.818    0.413</span></span>
<span id="cb32-66"><a href="#cb32-66" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished:year -0.0001932  0.0110347  -0.018    0.986</span></span>
<span id="cb32-67"><a href="#cb32-67" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-68"><a href="#cb32-68" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-69"><a href="#cb32-69" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 7:</span></span>
<span id="cb32-70"><a href="#cb32-70" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-71"><a href="#cb32-71" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Coefficients:</span></span>
<span id="cb32-72"><a href="#cb32-72" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#                              Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb32-73"><a href="#cb32-73" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># (Intercept)                -17.907032  18.715678  -0.957    0.339</span></span>
<span id="cb32-74"><a href="#cb32-74" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished       14.028995  23.085770   0.608    0.543</span></span>
<span id="cb32-75"><a href="#cb32-75" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># year                         0.008921   0.009267   0.963    0.336</span></span>
<span id="cb32-76"><a href="#cb32-76" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished:year  -0.006946   0.011431  -0.608    0.544</span></span>
<span id="cb32-77"><a href="#cb32-77" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-78"><a href="#cb32-78" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-79"><a href="#cb32-79" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 8:</span></span>
<span id="cb32-80"><a href="#cb32-80" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-81"><a href="#cb32-81" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Coefficients:</span></span>
<span id="cb32-82"><a href="#cb32-82" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#                              Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb32-83"><a href="#cb32-83" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># (Intercept)                  6.752287  12.723635   0.531    0.596</span></span>
<span id="cb32-84"><a href="#cb32-84" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished      -12.271939  15.989471  -0.768    0.443</span></span>
<span id="cb32-85"><a href="#cb32-85" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># year                        -0.003312   0.006300  -0.526    0.599</span></span>
<span id="cb32-86"><a href="#cb32-86" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished:year   0.006072   0.007917   0.767    0.443</span></span>
<span id="cb32-87"><a href="#cb32-87" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-88"><a href="#cb32-88" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-89"><a href="#cb32-89" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 9:</span></span>
<span id="cb32-90"><a href="#cb32-90" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-91"><a href="#cb32-91" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Coefficients:</span></span>
<span id="cb32-92"><a href="#cb32-92" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#                              Estimate Std. Error t value Pr(&gt;|t|)  </span></span>
<span id="cb32-93"><a href="#cb32-93" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># (Intercept)                -32.047082  19.468412  -1.646   0.1000 .</span></span>
<span id="cb32-94"><a href="#cb32-94" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished        9.713953  25.496311   0.381   0.7033  </span></span>
<span id="cb32-95"><a href="#cb32-95" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># year                         0.015940   0.009639   1.654   0.0984 .</span></span>
<span id="cb32-96"><a href="#cb32-96" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished:year  -0.004821   0.012624  -0.382   0.7026  </span></span>
<span id="cb32-97"><a href="#cb32-97" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># ---</span></span>
<span id="cb32-98"><a href="#cb32-98" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span id="cb32-99"><a href="#cb32-99" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-100"><a href="#cb32-100" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-101"><a href="#cb32-101" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Topic 10:</span></span>
<span id="cb32-102"><a href="#cb32-102" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># </span></span>
<span id="cb32-103"><a href="#cb32-103" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># Coefficients:</span></span>
<span id="cb32-104"><a href="#cb32-104" tabindex="-1"></a><span class="er">&gt;</span><span class="co">#                             Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb32-105"><a href="#cb32-105" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># (Intercept)                 5.495896  18.222081   0.302    0.763</span></span>
<span id="cb32-106"><a href="#cb32-106" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished      -9.392372  21.664020  -0.434    0.665</span></span>
<span id="cb32-107"><a href="#cb32-107" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># year                       -0.002683   0.009022  -0.297    0.766</span></span>
<span id="cb32-108"><a href="#cb32-108" tabindex="-1"></a><span class="er">&gt;</span><span class="co"># is_publishedpublished:year  0.004663   0.010727   0.435    0.664</span></span></code></pre></div>
<div class="section level4">
<h4 id="publication-year-1">Publication year<a class="anchor" aria-label="anchor" href="#publication-year-1"></a>
</h4>
<p>Use the <code>stm</code> plot method to create a plot that shows the
effect of publication <code>year</code> on topical prevalence for Topic
4 and Topic 8. Annotate with the most probable terms.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">biodiv_effect_K10</span>,</span>
<span>     covariate <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>     method <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>     model <span class="op">=</span> <span class="va">biodiv_model_K10</span>,</span>
<span>     topics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>     xaxt <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">'Effect of publication year on prevalence of Topic 4 ("???") and Topic 8 ("???")'</span>,</span>
<span>     labeltype <span class="op">=</span> <span class="st">"prob"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Publication year"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2017"</span>,<span class="st">"2018"</span>,<span class="st">"2019"</span>,<span class="st">"2020"</span>, <span class="st">"2021"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2017</span>, <span class="fl">2018</span>, <span class="fl">2019</span>, <span class="fl">2020</span>, <span class="fl">2021</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercise1-biodiv_files/figure-html/unnamed-chunk-35-1.png" width="960"></p>
<p>Alternatively, the <code>stminsights</code> package could be used to
extract the same regression information from the <code>stm</code>
effects object and create customized charts.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cschwem2er/stminsights" class="external-link">stminsights</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">year_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/stminsights/man/get_effects.html" class="external-link">get_effects</a></span><span class="op">(</span>estimates <span class="op">=</span> <span class="va">biodiv_effect_K10</span>, </span>
<span>                           variable <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>                           type <span class="op">=</span> <span class="st">"continuous"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">year_effect</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">topic</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Topic"</span>, <span class="va">topic</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">proportion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>, </span>
<span>                  alpha <span class="op">=</span> <span class="fl">0.2</span>, linetype <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>  <span class="op">+</span></span>
<span>      <span class="fu">xlab</span><span class="op">(</span><span class="st">"Publication year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">ylab</span><span class="op">(</span><span class="st">"Topic prevalence"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">topic</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercise1-biodiv_files/figure-html/unnamed-chunk-36-1.png" width="768"></p>
</div>
<div class="section level4">
<h4 id="publication-status-effect-1">Publication status effect<a class="anchor" aria-label="anchor" href="#publication-status-effect-1"></a>
</h4>
<p>We also incoporated the publication status into the model (covariate
<code>is_published</code>). Using the <code>stm</code> plot method
explore the effect of the treatment “published” on topical
prevalence.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">biodiv_effect_K10</span>, </span>
<span>     covariate <span class="op">=</span> <span class="st">"is_published"</span>,</span>
<span>     <span class="co">#topics = c(9, 10, 16, 1),</span></span>
<span>     model <span class="op">=</span> <span class="va">biodiv_model_K10</span>, </span>
<span>     method <span class="op">=</span> <span class="st">"difference"</span>,</span>
<span>     cov.value1 <span class="op">=</span> <span class="st">"published"</span>, cov.value2 <span class="op">=</span> <span class="st">"not published"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"higher prevalence in unpublished ... higher prevalence in published"</span>,</span>
<span>     <span class="co">#xlim = c(-0.19, 0.1),</span></span>
<span>     <span class="co">#labeltype = "prob",</span></span>
<span>     main <span class="op">=</span> <span class="st">"Effect of preprint server (treatment 'published')"</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercise1-biodiv_files/figure-html/unnamed-chunk-37-1.png" width="2400"></p>
<p>Compare the topical prevalence effect of covariate
<code>is_published</code> for Topic 4.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">biodiv_effect_K10</span>, </span>
<span>     covariate <span class="op">=</span> <span class="st">"is_published"</span>,</span>
<span>     topics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>     model <span class="op">=</span> <span class="va">biodiv_model_K10</span>, </span>
<span>      method <span class="op">=</span> <span class="st">"pointestimate"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Topical prevalence"</span>,</span>
<span>     <span class="co">#xlim = c(-0.04, 0.2),</span></span>
<span>     <span class="co">#labeltype = "prob",</span></span>
<span>     main <span class="op">=</span> <span class="st">"Effect of preprint 'is_published' covariate for Topic 4"</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercise1-biodiv_files/figure-html/unnamed-chunk-38-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="combination-of-publication-status-and-publication-year-1">Combination of publication status and publication year<a class="anchor" aria-label="anchor" href="#combination-of-publication-status-and-publication-year-1"></a>
</h4>
<p>Finally, we can also explore the combined effect of covariates; we
assumed an interacting effect of the two covariates
<code>is_published</code> and <code>year</code>. Using the
<code>stm</code> plot function explore the combined interacting
covariate effect for Topic 4.</p>
<p><img src="exercise1-biodiv_files/figure-html/unnamed-chunk-39-1.png" width="1500"></p>
<p>Again, <code>stminsights</code> can be used to retrieve this
information and create customized visualizations for the combined
covariate effect.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">published_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/stminsights/man/get_effects.html" class="external-link">get_effects</a></span><span class="op">(</span><span class="va">biodiv_effect_K10</span>, </span>
<span>                                variable <span class="op">=</span> <span class="st">"year"</span>, type <span class="op">=</span> <span class="st">"continuous"</span>, </span>
<span>                                moderator <span class="op">=</span> <span class="st">"is_published"</span>, modval <span class="op">=</span> <span class="st">"published"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">unpublished_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/stminsights/man/get_effects.html" class="external-link">get_effects</a></span><span class="op">(</span><span class="va">biodiv_effect_K10</span>,</span>
<span>                                  variable <span class="op">=</span> <span class="st">"year"</span>, type <span class="op">=</span> <span class="st">"continuous"</span>, </span>
<span>                                  moderator <span class="op">=</span> <span class="st">"is_published"</span>, modval <span class="op">=</span> <span class="st">"not published"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">is_published_effects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">published_effect</span>, <span class="va">unpublished_effect</span><span class="op">)</span></span>
<span></span>
<span><span class="va">is_published_effects</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">topic</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Topic"</span>, <span class="va">topic</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">proportion</span>, color <span class="op">=</span> <span class="va">moderator</span>,</span>
<span>               group <span class="op">=</span> <span class="va">moderator</span>, fill <span class="op">=</span> <span class="va">moderator</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, </span>
<span>                      fill <span class="op">=</span> <span class="va">moderator</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, linetype <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">xlab</span><span class="op">(</span><span class="st">"Publication year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">ylab</span><span class="op">(</span><span class="st">"Topic prevalence"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">topic</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="exercise1-biodiv_files/figure-html/unnamed-chunk-40-1.png" width="768"></p>
</div>
</div>
<div class="section level3">
<h3 id="exploring-the-topic-structure-1">Exploring the topic structure<a class="anchor" aria-label="anchor" href="#exploring-the-topic-structure-1"></a>
</h3>
<div class="section level4">
<h4 id="topic-correlations-1">Topic correlations<a class="anchor" aria-label="anchor" href="#topic-correlations-1"></a>
</h4>
<p>Finally, retrieve the topic correlations matrix and plot a
cooccurrence network.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covid_topic_correlations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/stm/man/topicCorr.html" class="external-link">topicCorr</a></span><span class="op">(</span><span class="va">biodiv_model_K10</span>, cutoff <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">covid_topic_correlations</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercise1-biodiv_files/figure-html/unnamed-chunk-41-1.png" width="700"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Stefan Daume.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
